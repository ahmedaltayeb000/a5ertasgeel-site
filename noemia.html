<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ูููููุง ูุงูููุงู - ุขุฎุฑ ุชุณุฌูู</title>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJRXVJG9JQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZJRXVJG9JQ');
  </script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #270000, #050608 55%, #010102 100%);
      color: #f5f5f5;
      line-height: 1.9;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 16px 64px;
    }

    /* ุดุฑูุท ุญุงูุฉ ุงููุณุชุฎุฏู */
    .user-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      font-size: 13px;
      color: #ccc;
      background: #0c0c0c;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .user-bar span {
      max-width: 220px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-bar a {
      padding: 5px 12px;
      border-radius: 999px;
      background: #15171f;
      border: 1px solid rgba(255,255,255,0.1);
      font-weight: 600;
      text-decoration: none;
      color: #fff;
      font-size: 13px;
    }

    .user-bar a:hover {
      background: #ff3333;
      border-color: #ff3333;
      color: #fff;
    }

    .user-bar button {
      padding: 5px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #ff3333;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
    }

    /* ุงูููุฏุฑ */
    .hero-with-bg {
      position: relative;
      background: url('images/Gemini_Generated_Image_s59qb5s59qb5s59q.jpg') center/cover no-repeat;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,0.85);
      margin: 0 auto 32px;
      padding: 36px 20px 40px;
      text-align: center;
    }

    .hero-with-bg::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top, rgba(60,0,0,0.95), rgba(5,6,8,0.97)),
        rgba(0,0,0,0.55);
      backdrop-filter: blur(2px);
    }

    .hero-with-bg * {
      position: relative;
      z-index: 2;
    }

    .scary-title {
      font-size: 40px;
      color: #ff2222;
      letter-spacing: 3px;
      margin-bottom: 10px;
      text-shadow:
        0 0 6px rgba(255,0,0,0.7),
        0 0 18px rgba(255,0,0,0.85);
      animation: titleFlicker 2.6s infinite ease-in-out;
    }

    @keyframes titleFlicker {
      0%,18%{opacity:.9;}
      19%,22%{opacity:.3;}
      23%,60%{opacity:1;}
      61%,70%{opacity:.5;}
      71%,100%{opacity:.85;}
    }

    .hero-subtitle {
      color:#ddd;
      font-size:15px;
    }

    /* ุฑูุงุจุท ุงูุฑุฌูุน */
    .back-links {
      margin: 10px 0 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }

    .back-links a {
      padding: 6px 14px;
      border-radius:999px;
      background:#15171f;
      border:1px solid rgba(255,255,255,0.1);
      font-size:13px;
      color:#fff;
      font-weight:600;
      text-decoration: none;
    }

    .back-links a:hover {
      background:#ff3333;
      border-color:#ff3333;
    }

    /* ุงููุตุฉ */
    .story-box {
      background: radial-gradient(circle at top, #1b0000, #050608);
      border-radius:20px;
      padding:24px 20px 30px;
      box-shadow:0 18px 45px rgba(0,0,0,0.9);
      border:1px solid rgba(255,80,80,0.2);
      margin-bottom:26px;
    }

    .story-title {
      font-size:24px;
      margin-bottom:8px;
    }

    .story-meta {
      font-size:13px;
      color:#999;
      margin-bottom:18px;
    }

    .story-text {
      font-size:16px;
      color:#e5e5e5;
      white-space:pre-line;
    }

    .no-copy {
      user-select:none;
      cursor:default;
    }

    /* ูุดุบูู ุงูุตูุช */
    .audio-player {
      margin:20px auto 0;
      max-width:620px;
      padding:16px 22px;
      border-radius:999px;
      display:flex;
      align-items:center;
      gap:18px;
      background: radial-gradient(circle at top, #220000, #050608);
      border:1px solid rgba(255,60,60,0.35);
      box-shadow:
        0 18px 40px rgba(0,0,0,0.9),
        0 0 20px rgba(255,0,0,0.25);
    }

    .ap-left {
      display:flex;
      align-items:center;
      gap:12px;
    }

    .ap-play {
      width:54px;
      height:54px;
      border:none;
      border-radius:50%;
      background:#ff2222;
      cursor:pointer;
      color:#fff;
      font-size:20px;
    }

    .ap-play .icon-pause{display:none;}
    .audio-player.is-playing .icon-play{display:none;}
    .audio-player.is-playing .icon-pause{display:inline;}

    .ap-wave{
      flex:1;
      display:flex;
      gap:3px;
      padding:0 6px;
    }

    .ap-wave span{
      width:3px;
      height:4px;
      border-radius:999px;
      background:red;
      opacity:.35;
    }

    .audio-player.is-playing .ap-wave span{
      animation:wave 1s infinite;
      opacity:1;
    }

    @keyframes wave {
      0%,100%{height:4px;}
      30%{height:18px;}
      60%{height:10px;}
    }

    /* ===== ุชูุณูู ูุณู ุงูุชุนูููุงุช ุงููุทูุฑ ===== */
    .comments-box {
      background: #0e1014;
      border-radius: 20px;
      padding: 24px 20px;
      margin-bottom: 26px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .comments-title {
      color: #ff3333;
      margin-bottom: 16px;
      border-bottom: 1px solid #333;
      padding-bottom: 10px;
      font-size: 18px;
    }
    
    /* ุงูููุฑู */
    .comment-input, .reply-input-field {
      width: 100%;
      background: #050608;
      border: 1px solid #444;
      color: #fff;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 10px;
      resize: vertical;
      font-size: 14px;
    }
    .comment-input:focus, .reply-input-field:focus {
      outline: none;
      border-color: #ff3333;
    }
    .comment-btn, .reply-submit-btn {
      background: #ff3333;
      color: #fff;
      border: none;
      padding: 6px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: bold;
      font-size: 13px;
      transition: 0.3s;
    }
    .comment-btn:hover { background: #d00000; }

    /* ุงูุชุนููู ุงููุงุญุฏ */
    .single-comment {
      background: rgba(255,255,255,0.03);
      padding: 14px;
      border-radius: 12px;
      margin-bottom: 14px;
      border-right: 3px solid #444;
      transition: 0.3s;
    }
    .single-comment:hover { border-right-color: #ff3333; }

    .comment-header {
      font-size: 12px;
      color: #888;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
    }
    .comment-user { color: #ccc; font-weight: bold; }
    .comment-body { color: #e0e0e0; font-size: 15px; white-space: pre-wrap; line-height: 1.6; }

    /* ุฃุฒุฑุงุฑ ุงูุชูุงุนู (ูุงูู ูุฑุฏ) */
    .comment-actions {
      margin-top: 10px;
      display: flex;
      gap: 15px;
      font-size: 13px;
      color: #888;
      align-items: center;
    }
    .action-btn {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: 0.2s;
    }
    .action-btn:hover { color: #fff; }
    
    /* ุงููุงูู ุงููุดุท */
    .liked { color: #ff3333 !important; }
    .heart-icon { font-size: 16px; }

    /* ููุทูุฉ ุงูุฑุฏูุฏ */
    .replies-container {
      margin-top: 12px;
      margin-right: 15px; /* ุฅุฒุงุญุฉ ููุฏุงุฎู */
      padding-right: 10px;
      border-right: 2px solid rgba(255,255,255,0.1);
    }
    .single-reply {
      background: rgba(0,0,0,0.3);
      padding: 8px 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    /* ููุฑู ุงูุฑุฏ ุงููุฎูู */
    .reply-form-box {
      margin-top: 10px;
      display: none; /* ูุฎูู ุงูุชุฑุงุถูุงู */
      animation: fadeIn 0.3s;
    }
    .reply-form-box.open { display: block; }
    
    @keyframes fadeIn { from{opacity:0; transform:translateY(-5px);} to{opacity:1; transform:translateY(0);} }

    /* ุฒุฑ ุชุญููู ุงููุฒูุฏ */
    .load-more-container { text-align: center; margin-top: 20px; }
    .load-more-btn {
      background: transparent;
      border: 1px solid #ff3333;
      color: #ff3333;
      padding: 8px 24px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: bold;
    }
    .load-more-btn:hover { background: #ff3333; color: #fff; }

    /* Popup */
    .login-modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.8);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }

    .login-modal-backdrop.show{display:flex;}

    .login-modal{
      background:#200;
      border-radius:16px;
      padding:22px;
      max-width:380px;
      width:90%;
      text-align:center;
      border:1px solid #ff4444;
    }

    .btn-primary{
      background:#ff3333;
      color:#fff;
      padding:8px 18px;
      border-radius:999px;
      border:none;
      cursor:pointer;
    }

    .btn-ghost{
      background:none;
      color:#fff;
      border:1px solid #666;
      padding:8px 18px;
      border-radius:999px;
      cursor:pointer;
    }
  </style>
</head>

<body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { 
    getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp, 
    limit, doc, updateDoc, arrayUnion, arrayRemove 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBfs6I2_EDIVi5miIVVD11eowjesjoQs2o",
    authDomain: "a5er-tasgeel.firebaseapp.com",
    projectId: "a5er-tasgeel",
    storageBucket: "a5er-tasgeel.firebasestorage.app",
    messagingSenderId: "239464150088",
    appId: "1:239464150088:web:71a7288812dcfefc9c147d",
    measurementId: "G-ZJRXVJG9JQ"
  };

  const ADMIN_EMAIL = "ahmed.altayeb01000@gmail.com";
  const STORY_ID = "noemia_entity"; 

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // ุนูุงุตุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู
  const userLabel = document.getElementById('userLabel');
  const loginBtn = document.getElementById('loginLink');
  const logoutBtn = document.getElementById('logoutBtn');
  const profileLink = document.getElementById('profileLink');
  const dashboardLink = document.getElementById('dashboardLink');

  const commentFormArea = document.getElementById("commentFormArea");
  const loginToCommentMsg = document.getElementById("loginToCommentMsg");
  const commentInput = document.getElementById("commentInput");
  const submitCommentBtn = document.getElementById("submitCommentBtn");
  const commentsListEl = document.getElementById("commentsList");
  const loadMoreBtn = document.getElementById("loadMoreBtn");

  let currentUser = null;
  let commentsUnsubscribe = null; // ุนุดุงู ูููู ุงูุงุณุชูุงุน ุงููุฏูู ููุง ูุบูุฑ ุงูุนุฏุฏ
  let currentLimit = 3; // ูุจุฏุฃ ุจู 3 ุชุนูููุงุช ููุท

  // 1. ุฅุฏุงุฑุฉ ุญุงูุฉ ุงููุณุชุฎุฏู
  onAuthStateChanged(auth, user => {
    if (user) {
      currentUser = user;
      localStorage.setItem("loggedIn", "true");
      userLabel.textContent = "ูุณุฌูู ูู " + (user.email.split('@')[0]);
      
      loginBtn.style.display    = "none";
      logoutBtn.style.display   = "inline-block";
      profileLink.style.display = "inline-block";
      if (user.email === ADMIN_EMAIL) dashboardLink.style.display = "inline-block";

      logoutBtn.onclick = () => {
        signOut(auth).then(() => {
          localStorage.removeItem("loggedIn");
          window.location.href = "index.html";
        });
      };

      if(commentFormArea) commentFormArea.style.display = "block";
      if(loginToCommentMsg) loginToCommentMsg.style.display = "none";
    } else {
      currentUser = null;
      localStorage.removeItem("loggedIn");
      userLabel.textContent = "ุบูุฑ ูุณุฌูู ุงูุฏุฎูู";
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      profileLink.style.display = "none";
      dashboardLink.style.display = "none";

      if(commentFormArea) commentFormArea.style.display = "none";
      if(loginToCommentMsg) loginToCommentMsg.style.display = "block";
    }
  });

  // 2. ุฏุงูุฉ ุฌูุจ ุงูุชุนูููุงุช (ูุน ุงูุชุญูู ูู ุงูุนุฏุฏ)
  function loadComments(limitVal) {
    // ูู ููู ุงุณุชูุงุน ูุฏูู ุดุบุงูุ ููููู ุงูุฃูู
    if (commentsUnsubscribe) commentsUnsubscribe();

    const q = query(
      collection(db, "comments"), 
      where("storyId", "==", STORY_ID),
      orderBy("createdAt", "desc"),
      limit(limitVal) // ููุง ุงูุชุญูู ูู ุงูุนุฏุฏ
    );

    commentsUnsubscribe = onSnapshot(q, (snapshot) => {
      commentsListEl.innerHTML = ""; // ูุณุญ ุงููุงุฆูุฉ ูุฅุนุงุฏุฉ ุงูุฑุณู

      if (snapshot.empty) {
        commentsListEl.innerHTML = "<p style='color:#777;text-align:center;'>ูุณู ูููุด ุชุนูููุงุช.. ูู ุฃูู ูุงุญุฏ! ๐ป</p>";
        loadMoreBtn.style.display = "none";
        return;
      }

      snapshot.forEach(docSnap => {
        const commentData = docSnap.data();
        const commentId = docSnap.id;
        renderComment(commentId, commentData);
      });

      // ูู ุนุฏุฏ ุงูุชุนูููุงุช ุงููู ุฑุงุฌุนุฉ ุฃูู ูู ุงููููุชุ ูุฎูู ุฒุฑุงุฑ "ุนุฑุถ ุงููู"
      if (snapshot.docs.length < limitVal) {
        loadMoreBtn.style.display = "none";
      } else {
        loadMoreBtn.style.display = "inline-block";
      }
    });
  }

  // 3. ุฏุงูุฉ ุฑุณู ุงูุชุนููู ุงููุงุญุฏ (HTML)
  function renderComment(docId, data) {
    let timeStr = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('ar-EG') : "...";
    
    // ุญุณุงุจ ุงููุงููุงุช
    const likesArr = data.likes || [];
    const likeCount = likesArr.length;
    // ูู ุงููุณุชุฎุฏู ุงูุญุงูู ุนุงูู ูุงููุ
    const isLiked = currentUser && likesArr.includes(currentUser.uid);
    const heartClass = isLiked ? "liked" : "";

    // ุฅูุดุงุก ุงูุนูุตุฑ
    const div = document.createElement("div");
    div.className = "single-comment";
    div.innerHTML = `
      <div class="comment-header">
        <span class="comment-user">${data.userEmail ? data.userEmail.split('@')[0] : 'ูุฌููู'}</span>
        <span>${timeStr}</span>
      </div>
      <div class="comment-body">${data.text}</div>
      
      <div class="comment-actions">
        <div class="action-btn ${heartClass}" id="likeBtn-${docId}">
          <span class="heart-icon">โฅ</span> <span>${likeCount}</span>
        </div>
        <div class="action-btn" id="replyToggle-${docId}">
          <span>โฉ๏ธ ุฑุฏ</span>
        </div>
      </div>

      <div class="reply-form-box" id="replyBox-${docId}">
        <input type="text" class="reply-input-field" id="replyInput-${docId}" placeholder="ุงูุชุจ ุฑุฏู ููุง...">
        <button class="reply-submit-btn" id="sendReply-${docId}">ุฅุฑุณุงู ุงูุฑุฏ</button>
      </div>

      <div class="replies-container" id="repliesList-${docId}"></div>
    `;

    commentsListEl.appendChild(div);

    // -- ุชูุนูู ุฒุฑ ุงููุงูู --
    document.getElementById(`likeBtn-${docId}`).onclick = () => toggleLike(docId, likesArr);

    // -- ุชูุนูู ุฒุฑ ุฅุธูุงุฑ ุงูุฑุฏ --
    document.getElementById(`replyToggle-${docId}`).onclick = () => {
      const box = document.getElementById(`replyBox-${docId}`);
      if (!currentUser) return alert("ูุงุฒู ุชุณุฌู ุฏุฎูู ุนุดุงู ุชุฑุฏ!");
      box.classList.toggle("open");
    };

    // -- ุชูุนูู ุฒุฑ ุฅุฑุณุงู ุงูุฑุฏ --
    document.getElementById(`sendReply-${docId}`).onclick = () => sendReply(docId);

    // -- ุชุญููู ุงูุฑุฏูุฏ ุงูุฎุงุตุฉ ุจุงูุชุนููู ุฏู --
    loadReplies(docId);
  }

  // 4. ููุทู ุงููุงูู (Toggle)
  async function toggleLike(commentId, currentLikes) {
    if (!currentUser) return alert("ุณุฌูู ุฏุฎูู ุนุดุงู ุชุนูู ูุงูู โค๏ธ");
    
    const commentRef = doc(db, "comments", commentId);
    
    if (currentLikes.includes(currentUser.uid)) {
      // ุฅุฒุงูุฉ ุงููุงูู
      await updateDoc(commentRef, { likes: arrayRemove(currentUser.uid) });
    } else {
      // ุฅุถุงูุฉ ูุงูู
      await updateDoc(commentRef, { likes: arrayUnion(currentUser.uid) });
    }
  }

  // 5. ุฅุฑุณุงู ุชุนููู ุฑุฆูุณู
  if (submitCommentBtn) {
    submitCommentBtn.onclick = async () => {
      const text = commentInput.value.trim();
      if (!text) return alert("ุงูุชุจ ุญุงุฌุฉ ุงูุฃูู!");
      if (!currentUser) return;

      try {
        await addDoc(collection(db, "comments"), {
          storyId: STORY_ID,
          text: text,
          userEmail: currentUser.email,
          createdAt: serverTimestamp(),
          likes: [] // ูุตูููุฉ ูุงุถูุฉ ููุงููุงุช
        });
        commentInput.value = ""; 
      } catch (err) {
        console.error(err);
      }
    };
  }

  // 6. ุฅุฑุณุงู ุฑุฏ (Sub-collection)
  async function sendReply(parentId) {
    const input = document.getElementById(`replyInput-${parentId}`);
    const text = input.value.trim();
    if (!text) return;

    try {
      // ุจูุญูุธ ุงูุฑุฏ ุฌูู "replies" ุฏุงุฎู ูุณุชูุฏ ุงูุชุนููู ุงูุฃุตูู
      await addDoc(collection(db, "comments", parentId, "replies"), {
        text: text,
        userEmail: currentUser.email,
        createdAt: serverTimestamp()
      });
      input.value = "";
      document.getElementById(`replyBox-${parentId}`).classList.remove("open"); // ุงููู ุงูุจููุณ
    } catch (err) {
      console.error(err);
      alert("ูุดู ุงูุฅุฑุณุงู");
    }
  }

  // 7. ุชุญููู ุงูุฑุฏูุฏ ููู ุชุนููู
  function loadReplies(parentId) {
    const repliesContainer = document.getElementById(`repliesList-${parentId}`);
    const q = query(
      collection(db, "comments", parentId, "replies"),
      orderBy("createdAt", "asc") // ุงููุฏูู ููู ูุงูุฌุฏูุฏ ุชุญุช ูู ุงูุฑุฏูุฏ
    );

    onSnapshot(q, (snapshot) => {
      repliesContainer.innerHTML = ""; // ุชูุธูู
      snapshot.forEach(doc => {
        const data = doc.data();
        const rDiv = document.createElement("div");
        rDiv.className = "single-reply";
        rDiv.innerHTML = `
          <strong style="color:#bbb">${data.userEmail ? data.userEmail.split('@')[0] : 'ูุฌููู'}:</strong>
          <span style="color:#ddd">${data.text}</span>
        `;
        repliesContainer.appendChild(rDiv);
      });
    });
  }

  // 8. ุฒุฑ "ูุฑุงุกุฉ ูู ุงูุชุนูููุงุช"
  if (loadMoreBtn) {
    loadMoreBtn.onclick = () => {
      currentLimit = 100; // ุฑูู ูุจูุฑ ุนุดุงู ูุฌูุจ ููู
      loadComments(currentLimit);
      loadMoreBtn.style.display = "none"; // ุงุฎููู ุจุนุฏ ูุง ุชุฏูุณ
    };
  }

  // ุจุฏุก ุงูุชุญููู ุนูุฏ ูุชุญ ุงูุตูุญุฉ (ุฃูู 3)
  loadComments(currentLimit);

</script>

<div class="page">

  <div class="user-bar">
    <span id="userLabel">ุบูุฑ ูุณุฌูู ุงูุฏุฎูู</span>
    <a href="profile.html" id="profileLink" style="display:none;">ุงูููู ุงูุดุฎุตู</a>
    <a href="dashboard.html" id="dashboardLink" style="display:none;">ููุญุฉ ุงูุชุญูู</a>
    <a href="login.html" id="loginLink">ุชุณุฌูู ุงูุฏุฎูู</a>
    <button id="logoutBtn" style="display:none;">ุชุณุฌูู ุฎุฑูุฌ</button>
  </div>

  <header class="hero-with-bg">
    <h1 class="scary-title">ุขุฎุฑ ุชุณุฌูู</h1>
    <p class="hero-subtitle">ููู ุฑุนุจ ุตูุชูโฆ ูุตุฉ ุญููููุฉ ุจูุณุฎุฉ ูุณููุนุฉ ูููุชูุจุฉ.</p>
  </header>

  <div class="back-links">
    <a href="index.html">โฌ๏ธ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
    <a href="h18-stories.html">โฌ๏ธ ูุณู ูุตุต ุฑุนุจ +18</a>
  </div>

  <section class="story-box">
    <h1 class="story-title">ูููููุง ูุงูููุงู</h1>
    <div class="story-meta">ุชุตููู: ุฑุนุจ / ุณุญุฑ / ูุนูุฉ ุนุงุฆููุฉ โ +18</div>

    <div class="player-box">
      <div class="audio-player" id="audioPlayer">
        <audio id="storyAudio" src="audio/download%20(4).wav"></audio>

        <div class="ap-left">
          <button class="ap-play" id="playToggle">
            <span class="icon-play">โถ</span>
            <span class="icon-pause">โธ</span>
          </button>
          <div class="ap-info">
            <div class="ap-title">ุชุดุบูู ุงูุชุณุฌูู</div>
            <div class="ap-sub">ูููููุง ูุงูููุงู</div>
          </div>
        </div>

        <div class="ap-wave">
          <span></span><span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span><span></span>
        </div>

        <div class="ap-rec">
          <span class="dot"></span>
          <span class="txt">REC</span>
        </div>
      </div>
    </div>

    <div style="text-align:center;margin:22px 0;">
      <button id="downloadBtn"
              data-file="audio/download%20(4).wav"
              style="padding:8px 18px;border-radius:999px;background:#ff3333;color:#fff;border:none;cursor:pointer;">
        โฌ๏ธ ุชุญููู ููู ุงูุตูุช
      </button>
    </div>

    <hr style="margin:22px 0;border-color:rgba(255,255,255,.05);" />

    <div class="story-text no-copy">
     ุงูุณุญุฑโฆ ููุฌูุฏโฆ
ููุด ูุนุจ ุนูุงูโฆ
ููุง ูููุฉโฆ ุจุชุชูุงู ูู ุงูุถููุฉโฆ
ูููู ูุงุณโฆ ูุง ูุนุฑููุด ุงูุฎูุฑ ุฃุตููุงโฆ
ูุจูุณุชุนููููโฆ ููุงูุชูุงูโฆ
ุฃุฑูุงุญโฆ ุจุชุชุญุฑูโฆ
ูุฃุจูุงุจโฆ ุจุชุชูุชุญ ููุญุฏูุงโฆ
ูููู ูุนูุงุชโฆ ุจุชูุถู ูุงุดูุฉ ูุฑุง ุงููุงุณโฆ ุณูููโฆ
ุฃูุงโฆ ูููููุงโฆ
ูุฏูโฆ ุขุฎุฑ ุชุณุฌููโฆ
ูุญูุงูุชูโฆ ุญูุงูุฉ ุฑุนุจโฆ ูุญุฏุด ุตุฏูููุงโฆ
ูุญููููุฉโฆ ูุฏุฑุฌุฉ ุฅู ููุจูโฆ ูุญุฏ ุฏูููุชูโฆ ุจูุฎุจุทโฆ ูุฃูุง ุจููููุงโฆ
ูู ุญุงุฌุฉโฆ ุจุฏุฃุชโฆ ูู ุจูุช ุจุณูุทโฆ
ูู ุณุงู ุจุงูููโฆ ุจุงูุจุฑุงุฒููโฆ
ุจูุช ูุงู ููู ุถุญูโฆ ุตูุช ุนูุงูโฆ ุฑูุญุฉ ุฃููโฆ
ุญูุงุฉโฆ ูุงุฏูุฉโฆ
ูุจูููโฆ ููููุฉโฆ
ุจูู ููู ุตุฑูุฎโฆ ูุฎุถูุฉโฆ ูุตูุช ุฎุทูุงุชโฆ ูู ุงูุถููุฉโฆ
ูู ูุง ูุญุงูู ููุฑุจโฆ ุงูุฑุนุจโฆ ููุฌุฑู ูุฑุงูุงโฆ
ูู ูุง ูููุฑ ุดูุนุฉโฆ ุงูููุฑโฆ ูุทูู ูุฌุฃุฉโฆ
ูุงููููโฆ ูุงู ููู ุตูุชโฆ ุจูุชุชููุณโฆ ุชูููโฆ ุจุงุฑุฏโฆ ูุฑูุจ ุฃููโฆ
ููุฅููโฆ ุดุงููโฆ ููุณุชููโฆ
ููุช ููุชูุง ุนูุฏู ูุงุญุฏ ูุนุดุฑูู ุณูุฉโฆ
ูุงุฑููุณโฆ ุฌูุฒูโฆ ูุงู ุจูุดุชุบู ุทูู ุงููููโฆ
ูุฃูุงโฆ ูุงุนุฏุฉ ูุน ุจูุชู ุงูุตุบูุฑุฉโฆ
ุญูุงุชูุง ูุงูุช ุนุงุฏูุฉโฆ ูุญุฏ ุงูููู ุงููู ููุจ ูู ุญุงุฌุฉโฆ
ูููุง ุจููุนุจโฆ ุงูุตูุช ุนุงููโฆ ุถุญูโฆ ูุฎุจุทโฆ
ูุนุฏุช ุฃุฑูุญ ุนูู ุงูููุจุฉ ุดููุฉโฆ ูุจุตููุช ุจุงูุตุฏูุฉโฆ
ูุดููุชโฆ ุงููู ูุง ูุชุดุงูุดโฆ
ุงูููุจุฉโฆ ูุงูุช ููุทูุนุฉโฆ
ูุด ููุทูุนุฉโฆ ูุงโฆ ูุฎุฑูุดุฉโฆ
ูุฎุงูุจโฆ ุดุฑุทุงุช ุทูููุฉโฆ ูุบููุทุฉโฆ ุฒู ุญุฏ ูุงู ุจูุฌุฑูุญ ุงูููุงุดโฆ ููู ุจูุตุฑุฎโฆ
ุจุตููุช ูุฃูุทููููโฆ ุงุจู ุฃุฎุชูโฆ ูููุชูู ุจุฎูู:
ุฅูุช ุงููู ุนููุช ูุฏู ูุง ุดููุ
ุงููุงุฏ ุนููุทโฆ ุจุณ ูุด ุนูุงุท ุทูู ุนูู ุบูุทุฉโฆ ุฏู ูุงู ุนูุงุท ุฎููโฆ
ููุงู:
ูุด ุฃูุง ูุง ุฎุงูุชูโฆ ุจุณโฆ ูุงูุช ูุงููุฉ ูุฑุงูู.
ููุง ุณูุนุช ุงูุฌููุฉ ุฏูโฆ ุฏูู ุจุฑุฏโฆ ููุจู ููุนโฆ
ุจุตููุช ูุฑุงูุงโฆ
ูููุด ุญุงุฌุฉโฆ ุจุณ ุญุณููุช ุญุฏโฆ ูุงูู ูุนููุงโฆ
ุจุงููููโฆ ุญูุงูุงโฆ ุจูุฏุฑูโฆ ุดุงู ุงูููุจุฉโฆ
ูุณููุงโฆ ุดูููุงโฆ ูุจุตู ูู ุงูุดุฑุทุงุชโฆ
ููุงู ุจุตูุชโฆ ูุฑุนูุจ:
ุฏูโฆ ูุด ุดุบู ุจูู ุขุฏู.
ูุจุนุฏูุง ุจูุฐุง ูููโฆ ูุงู ุฅูู ุดุงู ุงูููุงูโฆ
ุฅูุฏ ูุจูุฑุฉโฆ ุดุนุฑ ุฃุญูุฑโฆ ูุฎุงูุจ ุณูุฏุง ุทูููุฉโฆ ุจุชููุนโฆ ุฒู ุงูุณูููโฆ
ูุจูุฌุฑุฏ ูุง ุฑูุดโฆ ุงุฎุชููโฆ
ุจุณโฆ ุงูุฎููโฆ ูุถู ูู ุนูููโฆ ูุญุฏ ููููโฆ
ูู ุงูููู ุฏูโฆ ุงูุจูุชโฆ ุจูู ูุด ุจูุชโฆ
ุธูุงู ุจุชุฌุฑู ุนูู ุงูุญูุทุฉโฆ ุงููุฑุงูุงุช ุจุชุชูุณุฑโฆ ูุงูุฃุจูุงุจโฆ ุจุชุชูุชุญ ูุชุชุฑุฒุน ููุญุฏูุงโฆ
ููู ูููโฆ ูุฃูุง ูุงุนุฏุฉโฆ ุงููุฑุณู ุงุชูุทุน ูู ุชุญุชู ูุฌุฃุฉโฆ
ูููุง ุตูููุชโฆ ุงูููุฑ ุทููโฆ ูุงูููุงโฆ ุงุชููโฆ
ูุฅู ุงูุจูุช ููุณูโฆ ุจูุฎุฑุฌ ููุณ.
ุงูุญุฌุงุฑุฉ ูุงูุช ุจุชูุฒู ูู ุงูุณุทุญโฆ
ุงููุงุฑ ุชูููุน ูู ุงูุฌุฑุงูุฏโฆ ูุชุทููโฆ
ุงููุฏูู ุชุชูุทุนโฆ ููู ูุชุทุจูุฉโฆ
ุงููููุณ ุชุฎุชููโฆ ูุจูุธูุฑ ููุงููุงโฆ ูุฑูโฆ ุนููู ุตููุจ ุฃุญูุฑโฆ
ููุฅู ุญุฏโฆ ุจูุณูุจ ุฑุณุงูุฉโฆ
ูุงุฑููุณโฆ ููู ุบุตู ุฑูุฒูุงุฑูโฆ ูู ุฌูุจูโฆ ูุด ุจุชุงุนูโฆ
ูุบุตู ุชุงููโฆ ุนูู ุงูุดุจุงูโฆ
ูุงูุฎุจุฑุงุก ูุงููุง:
ุฏู ุณุญุฑโฆ ุญุฏ ุจููุชุญ ุจุงุจโฆ ูุฑูุญ.
ูููููุง ุถูุงุฏุนโฆ ูุญุฑููุฉโฆ ุฃุดูุงูโฆ ูุด ุขุฏููุฉ.
ุณุงุนุชูุง ููููุงโฆ ุฏู ูุด ุตุฏูุฉ.
ูุงุฑููุณ ุงูุชูุฑ ุฒูุฑุงูุฏโฆ ุญุจูุจุชู ุงููุฏููุฉโฆ ุงููู ุงุชุฌููุช ููุง ุณุงุจูุงโฆ
ูุฃููุงโฆ ูุงูุช ุจุชุดุชุบู ูู ุงูุณุญุฑโฆ
ูุงูุญูููุฉโฆ ุฅู ุงููุนูุฉโฆ ุจุฏุฃุชโฆ ูู ููู ุฌูุงุฒูุง.
ููู ูููโฆ ุฎุจุทูุง ุงูุณุชููู ุนูู ุงูุจุงุจโฆ
ูุงุญุฏุฉ ุณูุฑุงุกโฆ ูุงูุชุงููุฉ ุจูุถุงโฆ
ูุนููููโฆ ูุด ุทุจูุนูุฉ.
ูุงููุง:
ุฌุงููู ูุจุงุฑู ุงูุจูุช.
ููุช ููู:
ูุด ูุชุฎุดููุง ุจูุชู.
ุฑุฌุนูุง ุชุงููโฆ ููู ุนูุฏ ุจูุชู ุฑูุซโฆ
ุฌุงุจูุง ูููุฉโฆ ูููโฆ ุฃูุง ุดูุช ุงูุฑูุญุงูโฆ ุฌูู ุงูุดูุทุฉ.
ูููุช ุงูุจุงุจโฆ ูู ูุดููู.
ุชุงูู ูููโฆ ุฑูุญุฉ ุจุฎูุฑโฆ ูุงููุฉ ุงูููุงูโฆ
ูุงูุณูุงูููโฆ ูุชุฌูุนุฉโฆ ุนูู ุดูู ุตููุจโฆ
ุณุงุนุชูุงโฆ ุงููุนูุฉ ุฏุฎูุช ุฑุณูู.
ุฑูุนุชโฆ ุฃุตูู ูุฒููุฑ ูุงุญุฏ ูุชุณุนููโฆ ูู ุงูุถููุฉโฆ
ุงูููุง ูุงู ุชูููโฆ ูุงูุฎุทูุงุชโฆ ุจุชูุฑุจโฆ ูุฑุงูุงโฆ ุจุจุทุกโฆ
ููุฌุฃุฉโฆ ุงููุงุฑ ูููุนุช ูู ุงูููุงโฆ
ูุธูุฑโฆ ุงูููุงูโฆ
ุฑุงุฌูโฆ ูุดู ูุงุฑโฆ ุตูุชู ุฎุดูโฆ ุจูููู ููุงูโฆ ูุด ูููููโฆ
ุจุณโฆ ุงูุตูุชโฆ ูุงูโฆ ููุฏู ุงูุฌุจุงูโฆ
ูุฃูุงโฆ ูุง ุฎูุชุดโฆ ุฑุบู ุฅูู ููุช ุจุนูุทโฆ
ุจุตููุช ููโฆ ูููุช:
ูุฃูู ููุช ุงูุฑุจ ููุฌุฃูโฆ ูุง ููุณู ุดุฑู.
ุงูููุงูโฆ ุตุฑุฎโฆ ุตุฑุฎุฉโฆ ุชูุทุน ุงููุฏุงูโฆ
ุงููุงุฑ ุทูุชโฆ ูุงูุจุฑูุฏุฉโฆ ุบุทุช ุฌุณููโฆ
ุจุณโฆ ุญุณููุชโฆ ุจุณูุงูโฆ ูุฃูู ูุฑุฉ.
ุจุนุฏูุงโฆ ูู ุญุงุฌุฉ ูููุชโฆ
ุงูุฑุนุจโฆ ุงูุชููโฆ
ุงูุตูุชโฆ ุณูุชโฆ
ูุงูุจูุชโฆ ุงุฑุชุงุญโฆ
ุงูุนููุฉโฆ ุณุงุจุช ุงูุจูุชโฆ ููุญุฏุดโฆ ูุนุฑู ุฑุงุญูุง ูููโฆ
ุจุนุฏ 30 ุณูุฉโฆ
ุงููููุงุช ุงุชูุชุญุชโฆ
ูุงูุชุดููุงโฆ ุฅู ุงููู ุญุตูโฆ ูุงู ุญููููโฆ
ูุงูุณุญุฑโฆ ูุงู ุณูุงุญโฆ
ูุงููุถูุฉโฆ ูุถููุง ูุญูููุง ูููุง ุณูููโฆ
ุฃูุงโฆ ูููููุงโฆ
ูุฏูโฆ ุขุฎุฑ ุชุณุฌููโฆ
ุงุณุชููโฆ ุงูุชุณุฌูู ุงูุชุงููโฆ
    </div>
  </section>

  <section class="comments-box">
    <h3 class="comments-title">ููุงุดุงุช ุงููุณุชูุนูู (ูุฑุนุจ) ๐ฌ</h3>
    
    <div id="commentFormArea" style="display:none;">
      <textarea id="commentInput" class="comment-input" placeholder="ุงูุชุจ ุฑุฃูู ุฃู ุชุญูููู ูููุตุฉ..."></textarea>
      <button id="submitCommentBtn" class="comment-btn">ูุดุฑ ุงูุชุนููู ๐ฉธ</button>
    </div>

    <div id="loginToCommentMsg" style="text-align:center; display:none; margin-bottom:20px;">
      <p style="color:#bbb;">ุนุงูุฒ ุชุดุงุฑูุ ูุงุฒู <a href="login.html" style="color:#ff3333;">ุชุณุฌู ุฏุฎูู</a> ุงูุฃูู.</p>
    </div>

    <div id="commentsList" class="comments-list">
      <p style="text-align:center;color:#666;">ุฌุงุฑู ุชุญููู ุงูุชุนูููุงุช...</p>
    </div>

    <div class="load-more-container">
      <button id="loadMoreBtn" class="load-more-btn" style="display:none;">โฌ๏ธ ูุฑุงุกุฉ ูู ุงูุชุนูููุงุช</button>
    </div>
  </section>

  <div class="back-links">
    <a href="index.html">โฌ๏ธ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
    <a href="h18-stories.html">โฌ๏ธ ูุณู ูุตุต ุฑุนุจ +18</a>
  </div>

</div>

<div id="loginModal" class="login-modal-backdrop">
  <div class="login-modal">
    <h2 class="login-modal-title">ุชุณุฌูู ุงูุฏุฎูู ูุทููุจ</h2>
    <p class="login-modal-text">
      ูุชุญููู ููู ุงูุตูุช ูุฌุจ ุฃู ุชููู ูุณุฌูู ุฏุฎูู.
    </p>
    <div style="display:flex;gap:10px;justify-content:center;">
      <button id="goLogin" class="btn-primary">ุชุณุฌูู ุงูุฏุฎูู</button>
      <button id="closeLogin" class="btn-ghost">ุฅูุบุงุก</button>
    </div>
  </div>
</div>

<script>
  // ููุทู ุงููุดุบู ุงูุตูุชู (ูููุตู ุนุงุฏู)
  const audioEl   = document.getElementById('storyAudio');
  const playBtn   = document.getElementById('playToggle');
  const playerBox = document.getElementById('audioPlayer');

  if (playBtn && audioEl && playerBox) {
    playBtn.onclick = () => {
      if (audioEl.paused) {
        audioEl.play();
        playerBox.classList.add("is-playing");
      } else {
        audioEl.pause();
        playerBox.classList.remove("is-playing");
      }
    };
  }

  const downloadBtn = document.getElementById("downloadBtn");
  const loginModal  = document.getElementById("loginModal");
  if (downloadBtn) {
    downloadBtn.onclick = () => {
      if (!localStorage.getItem("loggedIn")) {
        if (loginModal) loginModal.classList.add("show");
        return;
      }
      window.location.href = downloadBtn.dataset.file;
    };
  }

  const goLogin    = document.getElementById("goLogin");
  const closeLogin = document.getElementById("closeLogin");

  if (goLogin) {
    goLogin.onclick = () => window.location.href = "login.html";
  }

  if (closeLogin && loginModal) {
    closeLogin.onclick = () => loginModal.classList.remove("show");
  }
</script>

</body>
</html>
