<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„</title>

  <style>
    /* ========== RESET + GLOBAL ========== */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body { background: #050608; color: #f5f5f5; line-height: 1.7; }
    a { color: #ff4b4b; text-decoration: none; } a:hover { text-decoration: underline; }
    .page { max-width: 1400px; width: 100%; margin: 0 auto; padding: 32px 16px 64px; }

    /* ========== Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Dropdown) ========== */
    .user-bar { display: flex; justify-content: flex-end; align-items: center; background: #0c0c0c; padding: 10px 18px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; color: #ccc; position: relative; z-index: 100; }
    .user-info-group { display: flex; align-items: center; gap: 12px; cursor: pointer; user-select: none; }
    .welcome-text { font-size: 13px; color: #ddd; }
    .profile-icon-btn { width: 40px; height: 40px; border-radius: 50%; background: #15171f; border: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; color: #fff; transition: 0.3s; }
    .profile-icon-btn:hover { background: #ff3333; border-color: #ff3333; }
    .profile-icon-btn svg { width: 20px; height: 20px; fill: currentColor; }
    .dropdown-menu { position: absolute; top: 60px; left: 20px; background: #111; border: 1px solid #333; border-radius: 12px; width: 200px; box-shadow: 0 10px 30px rgba(0,0,0,0.9); display: none; flex-direction: column; overflow: hidden; z-index: 101; }
    .dropdown-menu.show { display: flex; animation: fadeIn 0.2s ease-out; }
    .dropdown-item { padding: 12px 16px; color: #eee; text-decoration: none; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.05); transition: 0.2s; display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .dropdown-item:last-child { border-bottom: none; }
    .dropdown-item:hover { background: #1f1f1f; color: #ff3333; text-decoration: none; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    /* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± ========== */
    .hero-with-bg { position: relative; background: url('images/Gemini_Generated_Image_s59qb5s59qb5s59q.jpg') center/cover no-repeat; border-radius: 20px; overflow: hidden; box-shadow: 0 18px 40px rgba(0,0,0,0.65); max-width: 1300px; width: 100%; margin: 0 auto 32px; padding: 40px 24px; text-align: center; }
    .hero-with-bg::before { content: ""; position: absolute; inset: 0; background: radial-gradient(circle at top, rgba(42,0,0,0.85), rgba(5,6,8,0.96)), rgba(0,0,0,0.4); backdrop-filter: blur(2px); }
    .hero-with-bg * { position: relative; z-index: 2; }
    .hero-subtitle { margin-top: 16px; font-size: 16px; color: #e0e0e0; }
    .scary-title { font-size: 48px; text-align: center; color: #ff2222; position: relative; font-family: "Creepster", sans-serif; letter-spacing: 3px; margin-bottom: 20px; animation: glitch 2.5s infinite alternate; text-shadow: 0 0 4px rgba(255, 0, 0, 0.8), 2px 0 6px rgba(0, 255, 255, 0.4); }
    @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-1px, 1px); } 40% { transform: translate(1px, -1px); } 60% { transform: translate(0.5px, 0); } 80% { transform: translate(-0.5px, 0); } 100% { transform: translate(0); } }
    .rec-indicator { display: inline-flex; align-items: center; gap: 6px; margin-top: -6px; margin-bottom: 8px; font-size: 12px; color: #ff7777; opacity: 0.95; }
    .rec-indicator .dot { width: 10px; height: 10px; border-radius: 50%; background: #ff3333; box-shadow: 0 0 12px rgba(255,50,50,0.9); animation: recBlink 1s infinite; }
    @keyframes recBlink { 0%, 60% { opacity: 1; } 61%, 100% { opacity: 0.1; } }

    /* ========== ÙƒØ§Ø±Øª Ù‚ØµØµ Ø±Ø¹Ø¨ +18 (Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù…Ø§Ù„) ========== */
    .horror18-section {
      max-width: 340px;
      width: 100%;
      
      /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø®Ù„ÙŠÙ†Ø§ Ø§Ù„ÙŠÙ…ÙŠÙ† auto ÙˆØ§Ù„Ø´Ù…Ø§Ù„ 0 Ø¹Ø´Ø§Ù† ØªØ±ÙˆØ­ Ø´Ù…Ø§Ù„ */
      margin: 0 auto 30px 0; 

      background: transparent;
      box-shadow: none;
      padding: 0;
    }

    .h18-card-link {
      display: block;
      position: relative;
      width: 100%;
      margin: 0;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.8);
      transition: 0.3s;
      text-decoration: none;
    }

    .h18-card-link:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 18px 40px rgba(0,0,0,1), 0 0 25px rgba(255,0,0,0.6);
    }

    .h18-img-wrapper {
      position: relative;
      width: 100%;
      padding-top: 125%; /* 4:5 aspect ratio */
    }

    .h18-img-wrapper img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.3s ease;
    }

    .h18-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ff0000;
      color: #fff;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      z-index: 2;
    }

    .h18-hover-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 3;
      padding: 20px;
      text-align: center;
    }

    .h18-card-link:hover .h18-hover-overlay {
      opacity: 1;
    }
    
    .h18-warning-text {
      color: #ff3333;
      font-size: 16px;
      font-weight: bold;
      line-height: 1.5;
      text-shadow: 0 0 10px rgba(255,0,0,0.5);
    }


    /* ========== Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ========== */
    .section { background: #0e1014; border-radius: 18px; padding: 24px 32px; margin: 0 auto 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.6); max-width: 1300px; width: 100%; }
    .section-title { font-size: 22px; margin-bottom: 10px; color: #ffffff; }
    .section-text { color: #d5d5d5; font-size: 15px; }
    .section-visitor { position: relative; overflow: hidden; background: radial-gradient(circle at top, #280000, #050608); border-radius: 20px; border: 1px solid rgba(255, 80, 80, 0.18); box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85); max-width: 1300px; margin: 0 auto 20px; padding: 24px 32px; }
    .contact-form { margin-top: 22px; max-width: 600px; margin-left: auto; margin-right: auto; display: flex; flex-direction: column; gap: 14px; }
    .contact-form input, .contact-form textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #ff4444; background: #0d0f12; color: #ffffff; font-size: 14px; }
    .contact-form button { margin-top: 4px; background: #ff3333; padding: 10px 20px; border-radius: 999px; border: none; color: #ffffff; font-weight: bold; cursor: pointer; transition: 0.3s; }
    .contact-form button:hover { background: #ff1111; }
    .social-list { list-style: none; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px; }
    .social-list li a { display: inline-block; padding: 8px 14px; border-radius: 999px; background: #15171f; border: 1px solid rgba(255,255,255,0.08); font-size: 13px; }

    /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø²Ø± */
    #ratingCounter { position: fixed; bottom: 80px; left: 24px; font-size: 14px; background: #0d0f12; padding: 6px 14px; border-radius: 999px; border: 1px solid #ff3333; color: #fff; box-shadow: 0 6px 15px rgba(255,50,50,0.3); z-index: 9998; opacity: 0; visibility: hidden; transition: opacity 0.6s ease; }
    #ratingCounter.pop { animation: ratingPop 0.3s ease-out; }
    @keyframes ratingPop { 0% { transform: scale(1); } 50% { transform: scale(1.12); } 100% { transform: scale(1); } }
    .rating-fab { position: fixed; bottom: 24px; left: 24px; padding: 10px 18px; border-radius: 999px; border: none; background: #ff3333; color: #fff; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.7); z-index: 9998; }
    .rating-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; }
    .rating-modal.show { display: flex; }
    .rating-modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
    .rating-modal-inner { position: relative; max-width: 700px; width: 95%; background: #08090d; border-radius: 20px; padding: 24px 20px 28px; box-shadow: 0 20px 50px rgba(0,0,0,0.9); border: 1px solid rgba(255,80,80,0.3); }
    .contact-form select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #ff4444; background: #0d0f12; color: #ffffff; font-size: 14px; }
    .rating-close { position: absolute; top: 10px; left: 14px; border: none; background: transparent; color: #fff; font-size: 20px; cursor: pointer; }
  </style>
</head>

<body>

  <div class="user-bar">
    <div class="user-info-group" id="userMenuTrigger">
      <span class="welcome-text" id="welcomeMsg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
      <div class="profile-icon-btn" id="profileIconContainer">
        </div>
    </div>
    <div class="dropdown-menu" id="userDropdown">
      <a href="profile.html" class="dropdown-item">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
      <a href="dashboard.html" class="dropdown-item" id="dashItem" style="display:none;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
      <div class="dropdown-item" id="logoutItem">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</div>
    </div>
  </div>

  <div class="page">
    <header class="hero hero-with-bg">
      <h1 class="scary-title">Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„</h1>
      <div class="rec-indicator"><span class="dot"></span><span class="rec-text">REC</span></div>
      <p class="hero-subtitle">
        ÙÙŠ ØºÙØ±Ù <span style="color:#ff3333;">Ù…Ù‚ÙÙˆÙ„Ø©</span> Ù…Ù† Ø³Ù†ÙŠÙ† Ø·ÙˆÙŠÙ„Ø©â€¦ Ø§ØªØ®Ø¨Ù‘Ù‰ ÙÙŠÙ‡Ø§ <span style="color:#ff8844;">Ø³Ø±</span> ÙˆØ±Ø§ Ø³Ø±.<br><br>
        Ø§Ù„Ù„ÙŠ Ù‡ØªØ³Ù…Ø¹Ù‡ Ù‡Ù†Ø§â€¦ Ù…Ø´ Ø®ÙŠØ§Ù„ØŒ Ø¯Ù‡ ØµÙˆØª Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù„ÙŠ ÙØ¶Ù„ Ù…Ù† Ù…Ù„ÙØ§Øª Ø§ØªØ®ØªÙ…Øª Ø¨Ù€ <span style="color:#ff0000;font-weight:bold;">Ø³Ø±ÙŠ Ø¬Ø¯Ù‹Ø§</span>.
      </p>
    </header>

    <section class="horror18-section">
      <a href="h18-stories.html" class="h18-card-link">
        <div class="h18-img-wrapper">
          <img src="images/Gemini_Generated_Image_dt2ou7dt2ou7dt2o.jpg" alt="Ù‚ØµØµ Ø±Ø¹Ø¨ +18">
          <div class="h18-badge">+18</div>
          <div class="h18-hover-overlay">
            <p class="h18-warning-text">
              âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØµØ§Ø¯Ù…<br>
              Ø§Ø¶ØºØ· Ù„Ù„Ø¯Ø®ÙˆÙ„
            </p>
          </div>
        </div>
      </a>
    </section>
    <section class="section section-visitor">
      <h2 class="section-title visitor-title">Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø²Ø§Ø¦Ø±</h2>
      <p class="section-text visitor-text">
        Ù„Ùˆ Ø¹Ø´Øª Ù‚ØµØ© Ø±Ø¹Ø¨ Ù„Ø³Ù‡ Ù…Ø´ Ù‚Ø§Ø¯Ø± ØªÙ†Ø³Ø§Ù‡Ø§ØŒ ÙˆØ¹Ø§ÙŠØ² Ù†Ø­ÙˆÙ„Ù‡Ø§ Ù„Ø³Ø±Ø¯ ØµÙˆØªÙŠ Ù‚ÙˆÙŠ...<br>
        Ø§Ø¨Ø¹ØªÙ„Ù†Ø§ Ù‚ØµØªÙƒØŒ ÙˆØ§Ø·Ù…Ù†â€¦ Ù‡ÙˆÙŠØªÙƒ ÙÙŠ Ø£Ù…Ø§Ù†.
      </p>
      <form class="contact-form" action="https://formspree.io/f/xgvjgzek" method="POST">
        <label>Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ): <input type="email" name="email" placeholder="Ù„Ùˆ Ø­Ø§Ø¨Ø¨ Ù†Ø±Ø¯ Ø¹Ù„ÙŠÙƒâ€¦"></label>
        <label>Ù‚ØµØªÙƒ: <textarea name="message" required placeholder="Ø§ÙƒØªØ¨ ØªØ¬Ø±Ø¨ØªÙƒ..."></textarea></label>
        <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
      </form>
    </section>

    <section class="social" style="margin-top:20px;text-align:center;">
      <h2 class="section-title">ØªØ§Ø¨Ø¹ â€œØ¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„â€</h2>
      <ul class="social-list">
        <li><a href="https://www.facebook.com/a5ertasgeel" target="_blank">ğŸ”µ ÙÙŠØ³Ø¨ÙˆÙƒ</a></li>
        <li><a href="#" target="_blank">ğŸ”´ ÙŠÙˆØªÙŠÙˆØ¨</a></li>
        <li><a href="#" target="_blank">âš« ØªÙŠÙƒ ØªÙˆÙƒ</a></li>
        <li><a href="#" target="_blank">ğŸŸ£ Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</a></li>
      </ul>
    </section>
  </div>

  <p id="ratingCounter">â­ <span id="ratingCountNumber"></span></p>
  <button id="ratingFab" class="rating-fab">ğŸ©¸ ØªÙ‚ÙŠÙŠÙ…Ùƒ ÙŠÙ‡Ù…Ù‘Ù†Ø§</button>

  <div id="ratingModal" class="rating-modal">
    <div class="rating-modal-backdrop"></div>
    <div class="rating-modal-inner">
      <button id="ratingClose" class="rating-close">âœ•</button>
      <h2 class="section-title" style="margin-bottom:6px;">Ù‚ÙŠÙ‘Ù… Ù…ÙˆÙ‚Ø¹ â€œØ¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„â€</h2>
      <form id="popupRatingForm" class="contact-form">
        <label>ØªÙ‚ÙŠÙŠÙ…Ùƒ: <select id="popupRatingValue" name="rating" required><option value="">Ø§Ø®ØªØ±...</option><option value="5">â­â­â­â­â­</option><option value="4">â­â­â­â­</option><option value="3">â­â­â­</option><option value="2">â­â­</option><option value="1">â­</option></select></label>
        <label>Ø±Ø£ÙŠÙƒ: <textarea id="popupRatingComment" name="comment" placeholder="Ø§ÙƒØªØ¨ Ø±Ø£ÙŠÙƒ..."></textarea></label>
        <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
        <p id="popupRatingMessage" style="margin-top:10px;font-size:14px;color:#9be29b;display:none;">Ø´ÙƒØ±Ø§Ù‹!</p>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc, setDoc, updateDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBfs6I2_EDIVi5miIVVD11eowjesjoQs2o",
      authDomain: "a5er-tasgeel.firebaseapp.com",
      projectId: "a5er-tasgeel",
      storageBucket: "a5er-tasgeel.firebasestorage.app",
      messagingSenderId: "239464150088",
      appId: "1:239464150088:web:71a7288812dcfefc9c147d",
      measurementId: "G-ZJRXVJG9JQ"
    };

    const ADMIN_EMAIL = "ahmed.altayeb01000@gmail.com";
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
    const userMenuTrigger = document.getElementById("userMenuTrigger");
    const welcomeMsg = document.getElementById("welcomeMsg");
    const profileIconContainer = document.getElementById("profileIconContainer");
    const userDropdown = document.getElementById("userDropdown");
    const dashItem = document.getElementById("dashItem");
    const logoutItem = document.getElementById("logoutItem");

    const iconLoggedIn = `<svg viewBox="0 0 16 16"><path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/></svg>`;
    const iconGuest = `<svg viewBox="0 0 16 16"><path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1zM4.97 3.03a.75.75 0 0 0-1.06 1.06L6.94 7.12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L8 8.18l1.97 1.97a.75.75 0 1 0 1.06-1.06L9.06 7.12l1.97-1.97a.75.75 0 1 0-1.06-1.06L8 6.06 6.03 4.09 4.97 3.03z"/></svg>`;

    let isUserLoggedIn = false;

    userMenuTrigger.addEventListener("click", (e) => {
      e.stopPropagation();
      if (isUserLoggedIn) { userDropdown.classList.toggle("show"); } else { window.location.href = "login.html"; }
    });
    document.addEventListener("click", () => { userDropdown.classList.remove("show"); });

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        isUserLoggedIn = true;
        localStorage.setItem("loggedIn", "true");
        const fullName = user.displayName || user.email.split('@')[0];
        const firstName = fullName.split(' ')[0];
        welcomeMsg.innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span style="color:#ff3333;font-weight:bold;">${firstName}</span> ÙÙŠ Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„`;
        profileIconContainer.innerHTML = iconLoggedIn;
        profileIconContainer.style.background = "#15171f";
        if (user.email === ADMIN_EMAIL) { dashItem.style.display = "flex"; } else { dashItem.style.display = "none"; }
        logoutItem.onclick = () => { signOut(auth).then(() => { localStorage.removeItem("loggedIn"); window.location.href = "index.html"; }); };
        loadUserRating(user.uid);
      } else {
        isUserLoggedIn = false;
        localStorage.removeItem("loggedIn");
        welcomeMsg.innerHTML = "ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
        profileIconContainer.innerHTML = iconGuest;
        profileIconContainer.style.background = "#330000";
      }
    });

    async function updateRatingCounter(animate=true) {
      const counter = document.getElementById("ratingCounter");
      const numSpan = document.getElementById("ratingCountNumber");
      if(!counter) return;
      try {
        const snap = await getDocs(collection(db, "siteRatings"));
        const total = snap.size;
        numSpan.textContent = total.toLocaleString("en-US");
        counter.style.visibility = "visible"; counter.style.opacity = "1";
      } catch(e){ console.error(e); }
    }
    updateRatingCounter(false);

    async function loadUserRating(uid) {
      const form = document.getElementById("popupRatingForm"); if(!form) return;
      try {
        const snap = await getDoc(doc(db, "siteRatings", uid));
        if(snap.exists()) {
          const val = document.getElementById("popupRatingValue");
          const msg = document.getElementById("popupRatingMessage");
          if(val) { val.value = snap.data().rating; val.disabled=true; }
          if(msg) { msg.textContent = "Ù„Ù‚Ø¯ Ù‚ÙŠÙ‘Ù…Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø³Ø¨Ù‚Ø§Ù‹ â­"; msg.style.display="block"; }
        }
      } catch(e){}
    }

    const fab = document.getElementById("ratingFab"); const modal = document.getElementById("ratingModal"); const close = document.getElementById("ratingClose");
    if(fab) fab.onclick = () => modal.classList.add("show");
    if(close) close.onclick = () => modal.classList.remove("show");
    if(modal) modal.onclick = (e) => { if(e.target===modal) modal.classList.remove("show"); };
    const rateForm = document.getElementById("popupRatingForm");
    if(rateForm) {
      rateForm.onsubmit = async (e) => {
        e.preventDefault();
        const val = document.getElementById("popupRatingValue").value;
        const comm = document.getElementById("popupRatingComment").value;
        if(!val) return alert("Ø§Ø®ØªØ± ØªÙ‚ÙŠÙŠÙ…!");
        try {
          const user = auth.currentUser;
          if(user) {
             const ref = doc(db, "siteRatings", user.uid);
             const snap = await getDoc(ref);
             if(snap.exists()) { await updateDoc(ref, { comment: comm, lastUpdated: serverTimestamp() }); } else { await setDoc(ref, { rating: val, comment: comm, userId: user.uid, createdAt: serverTimestamp() }); updateRatingCounter(true); }
          } else { await addDoc(collection(db, "siteRatings"), { rating: val, comment: comm, createdAt: serverTimestamp() }); updateRatingCounter(true); }
          alert("ØªÙ… Ø­ÙØ¸ ØªÙ‚ÙŠÙŠÙ…Ùƒ!"); modal.classList.remove("show");
        } catch(err) { console.error(err); }
      };
    }
  </script>
  <script src="https://cdn.botpress.cloud/webchat/v3.4/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/11/27/22/20251127225403-IQJ9GX5K.js" defer></script>
</body>
</html>
