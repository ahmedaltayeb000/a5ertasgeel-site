
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ±Ù…ÙŠÙ… Ø§Ù„ØµÙˆØ± - Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„</title>
  <style>
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© Ù„ØªÙ†Ø§Ø³Ø¨ Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
    * { box-sizing: border-box; font-family: system-ui, -apple-system, sans-serif; }
    body {
      background: #050608; /* Ù†ÙØ³ Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      max-width: 700px;
      width: 100%;
      background: #0e1014;
      border: 1px solid rgba(255, 51, 51, 0.2);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 0 40px rgba(0,0,0,0.8);
      text-align: center;
      margin-top: 40px;
    }

    h1 {
      color: #ff3333;
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 800;
    }

    p.subtitle { color: #888; margin-bottom: 30px; font-size: 16px; }

    /* Ù…Ù†Ø·Ù‚Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± */
    .upload-area {
      border: 2px dashed #444;
      border-radius: 15px;
      padding: 40px;
      cursor: pointer;
      transition: 0.3s;
      background: #15171f;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .upload-area:hover { border-color: #ff3333; background: rgba(255, 51, 51, 0.05); }
    
    #previewImg { 
      max-width: 100%; 
      max-height: 300px; 
      border-radius: 10px; 
      display: none; 
      margin: 0 auto; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    .upload-placeholder { display: block; }
    .upload-text { color: #ccc; margin-top: 10px; }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ */
    .modes-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 25px;
    }
    .mode-btn {
      background: #1e293b;
      border: 1px solid #333;
      color: #ccc;
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
      font-weight: bold;
    }
    .mode-btn:hover { background: #2d3748; }
    .mode-btn.active {
      border-color: #ff3333;
      background: rgba(255, 51, 51, 0.15);
      color: #ff3333;
    }

    /* Ø²Ø± Ø§Ù„ØªØ±Ù…ÙŠÙ… */
    .restore-btn {
      width: 100%;
      padding: 16px;
      background: #ff3333;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 5px 20px rgba(255, 51, 51, 0.3);
    }
    .restore-btn:disabled { background: #333; color: #777; cursor: not-allowed; box-shadow: none; }
    .restore-btn:hover:not(:disabled) { background: #d00000; transform: translateY(-2px); }

    /* Ø§Ù„Ù†ØªÙŠØ¬Ø© */
    .result-area { margin-top: 30px; display: none; animation: fadeIn 0.6s; border-top: 1px solid #333; padding-top: 20px; }
    .result-img { width: 100%; border-radius: 15px; border: 2px solid #00e676; box-shadow: 0 0 20px rgba(0, 230, 118, 0.2); }
    
    .download-btn {
      margin-top: 20px;
      background: #00e676;
      color: #000;
      padding: 12px 30px;
      border-radius: 999px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
      transition: 0.3s;
    }
    .download-btn:hover { background: #00c853; transform: scale(1.05); }

    /* Loading Spinner */
    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: none;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .back-link {
        margin-top: 30px;
        color: #666;
        text-decoration: none;
        font-size: 14px;
        display: inline-block;
        transition: 0.3s;
    }
    .back-link:hover { color: #ff3333; }
  </style>
</head>
<body>

  <div class="container">
    <h1>âœ¨ Ù…ÙØ±Ù…Ù… Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª</h1>
    <p class="subtitle">Ø£Ø¯Ø§Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø¥ØµÙ„Ø§Ø­ ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</p>

    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
      <input type="file" id="fileInput" hidden accept="image/*" onchange="handleFileSelect(event)">
      
      <div id="placeholder" class="upload-placeholder">
        <svg style="width:60px;color:#555;margin-bottom:10px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p class="upload-text">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</p>
      </div>
      
      <img id="previewImg" alt="Preview">
    </div>

    <div class="modes-grid">
      <div class="mode-btn active" onclick="setMode('All', this)">âœ¨ Ø´Ø§Ù…Ù„ (Ø¥ØµÙ„Ø§Ø­ ÙˆØªÙ„ÙˆÙŠÙ†)</div>
      <div class="mode-btn" onclick="setMode('Colorize', this)">ğŸ¨ ØªÙ„ÙˆÙŠÙ† ÙÙ‚Ø·</div>
      <div class="mode-btn" onclick="setMode('Repair', this)">ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø¯ÙˆØ´</div>
      <div class="mode-btn" onclick="setMode('Enhance', this)">HD Ø±ÙØ¹ Ø§Ù„Ø¬ÙˆØ¯Ø©</div>
    </div>

    <button id="restoreBtn" class="restore-btn" onclick="startRestoration()" disabled>
      <div class="spinner" id="loadingSpinner"></div>
      <span id="btnText">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
    </button>

    <div class="result-area" id="resultArea">
      <h3 style="color:#00e676; margin-bottom:15px;">ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­! âœ…</h3>
      <img id="restoredImg" class="result-img" alt="Restored Image">
      <a id="downloadLink" class="download-btn" download="restored_image.png">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</a>
    </div>

    <a href="index.html" class="back-link">â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>

  <script>
    // ===============================================
    // ğŸ”´ Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹: Ø¶Ø¹ Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
    const API_KEY = "AIzaSyD95OWbyLKyqDW1c3IXK363fp5ctm_kYUE"; 
    // ===============================================

    let selectedFile = null;
    let selectedMode = 'All';
    let base64Image = "";
    let mimeType = "";

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        selectedFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('placeholder').style.display = 'none';
          const img = document.getElementById('previewImg');
          img.src = e.target.result;
          img.style.display = 'block';
          
          base64Image = e.target.result.split(',')[1];
          mimeType = file.type;
          
          document.getElementById('restoreBtn').disabled = false;
          document.getElementById('resultArea').style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    }

    // ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹
    function setMode(mode, btn) {
      selectedMode = mode;
      document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    async function startRestoration() {
      if (!API_KEY || API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
        alert("âš ï¸ Ø®Ø·Ø£: Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ API ÙÙŠ Ø§Ù„ÙƒÙˆØ¯!");
        return;
      }

      const btn = document.getElementById('restoreBtn');
      const spinner = document.getElementById('loadingSpinner');
      const btnText = document.getElementById('btnText');
      const resultArea = document.getElementById('resultArea');

      btn.disabled = true;
      spinner.style.display = 'block';
      btnText.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
      resultArea.style.display = 'none';

      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Prompt)
      let prompt = "Fully restore this image. Repair damages, colorize if B&W, and enhance resolution.";
      if (selectedMode === 'Colorize') prompt = "Colorize this black and white image realistically.";
      if (selectedMode === 'Repair') prompt = "Repair scratches, tears, and folds in this image.";
      if (selectedMode === 'Enhance') prompt = "Enhance this image to high definition, sharpen details.";

      try {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ØµÙˆØ± (Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø®Ø§ØµØ©)
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
        
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{
              parts: [
                { text: prompt },
                { inlineData: { mimeType: mimeType, data: base64Image } }
              ]
            }],
            generationConfig: {
              responseModalities: ["IMAGE"] // Ø·Ù„Ø¨ ØµÙˆØ±Ø© ÙƒØ±Ø¯
            }
          })
        });

        if (!response.ok) {
          throw new Error(`Server Error: ${response.status}`);
        }

        const result = await response.json();
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø±Ø¯
        const candidates = result.candidates;
        let outputImageBase64 = null;

        if (candidates && candidates[0].content && candidates[0].content.parts) {
           const parts = candidates[0].content.parts;
           const imagePart = parts.find(p => p.inlineData);
           if (imagePart) {
             outputImageBase64 = imagePart.inlineData.data;
           }
        }

        if (outputImageBase64) {
          const finalUrl = `data:image/png;base64,${outputImageBase64}`;
          document.getElementById('restoredImg').src = finalUrl;
          document.getElementById('downloadLink').href = finalUrl;
          resultArea.style.display = 'block';
        } else {
          alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ ØµÙˆØ±Ø© Ù…Ø¹Ø¯Ù„Ø© (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ø­Ø³Ø§Ø¨Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹).");
        }

      } catch (error) {
        console.error(error);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message);
      } finally {
        btn.disabled = false;
        spinner.style.display = 'none';
        btnText.innerText = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©";
      }
    }
  </script>
</body>
</html>
