<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نويميا والكيان - آخر تسجيل</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJRXVJG9JQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZJRXVJG9JQ');
  </script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

    body {
      background: radial-gradient(circle at top, #270000, #050608 55%, #010102 100%);
      color: #f5f5f5;
      line-height: 1.9;
    }

    .page { max-width: 1100px; margin: 0 auto; padding: 32px 16px 64px; }

    /* شريط حالة المستخدم */
    .user-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
      font-size: 13px;
      color: #ccc;
    }
    .user-bar a {
      padding: 5px 12px;
      border-radius: 999px;
      background: #15171f;
      border: 1px solid rgba(255,255,255,0.1);
      font-weight: 600;
      text-decoration: none;
      color: #fff;
    }
    .user-bar a:hover { background: #ff3333; border-color: #ff3333; }
    .user-bar button {
      padding: 5px 12px; border-radius: 999px; border: none; cursor: pointer;
      background: #ff3333; color: #fff; font-size: 13px; font-weight: 600;
    }

    /* الهيدر */
    .hero-with-bg {
      position: relative;
      background: url('images/Gemini_Generated_Image_s59qb5s59qb5s59q.jpg') center/cover no-repeat;
      border-radius: 20px; overflow: hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,0.85);
      margin: 0 auto 32px; padding: 36px 20px 40px; text-align: center;
    }
    .hero-with-bg::before {
      content: ""; position: absolute; inset: 0;
      background: radial-gradient(circle at top, rgba(60,0,0,0.95), rgba(5,6,8,0.97)), rgba(0,0,0,0.55);
      backdrop-filter: blur(2px);
    }
    .hero-with-bg * { position: relative; z-index: 2; }

    .scary-title {
      font-size: 40px; color: #ff2222; letter-spacing: 3px; margin-bottom: 10px;
      text-shadow: 0 0 6px rgba(255,0,0,0.7), 0 0 18px rgba(255,0,0,0.85);
      animation: titleFlicker 2.6s infinite ease-in-out;
    }
    @keyframes titleFlicker {
      0%,18%{opacity:.9;} 19%,22%{opacity:.3;} 23%,60%{opacity:1;} 61%,70%{opacity:.5;} 71%,100%{opacity:.85;}
    }

    .hero-subtitle { color:#ddd; font-size:15px; }

    /* روابط الرجوع */
    .back-links {
      margin: 10px 0 20px;
      display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end;
    }
    .back-links a {
      padding: 6px 14px; border-radius:999px; background:#15171f;
      border:1px solid rgba(255,255,255,0.1); font-size:13px; color:#fff; font-weight:600;
    }
    .back-links a:hover { background:#ff3333; border-color:#ff3333; }

    /* قصة */
    .story-box {
      background: radial-gradient(circle at top, #1b0000, #050608);
      border-radius:20px; padding:24px 20px 30px;
      box-shadow:0 18px 45px rgba(0,0,0,0.9);
      border:1px solid rgba(255,80,80,0.2);
      margin-bottom:26px;
    }
    .story-title { font-size:24px; margin-bottom:8px; }
    .story-meta { font-size:13px; color:#999; margin-bottom:18px; }
    .story-text { font-size:16px; color:#e5e5e5; white-space:pre-line; }

    .no-copy { user-select:none; cursor:default; }

    /* الصوت */
    .audio-player {
      margin:20px auto 0; max-width:620px; padding:16px 22px;
      border-radius:999px; display:flex; align-items:center; gap:18px;
      background: radial-gradient(circle at top, #220000, #050608);
      border:1px solid rgba(255,60,60,0.35);
      box-shadow:0 18px 40px rgba(0,0,0,0.9), 0 0 20px rgba(255,0,0,0.25);
    }
    .ap-left{display:flex;align-items:center;gap:12px;}
    .ap-play{width:54px;height:54px;border:none;border-radius:50%;background:#ff2222;cursor:pointer;color:#fff;font-size:20px;}
    .ap-play .icon-pause{display:none;}
    .audio-player.is-playing .icon-play{display:none;}
    .audio-player.is-playing .icon-pause{display:inline;}

    .ap-wave{flex:1;display:flex;gap:3px;padding:0 6px;}
    .ap-wave span{width:3px;height:4px;border-radius:999px;background:red;opacity:.35;}
    .audio-player.is-playing .ap-wave span{animation:wave 1s infinite;opacity:1;}
    @keyframes wave {
      0%,100%{height:4px;} 30%{height:18px;} 60%{height:10px;}
    }

    /* Popup */
    .login-modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;
      align-items:center;justify-content:center;z-index:9999;
    }
    .login-modal-backdrop.show{display:flex;}
    .login-modal{
      background:#200; border-radius:16px; padding:22px;
      max-width:380px; width:90%; text-align:center;
      border:1px solid #ff4444;
    }
    .btn-primary{background:#ff3333;color:#fff;padding:8px 18px;border-radius:999px;border:none;}
    .btn-ghost{background:none;color:#fff;border:1px solid #666;padding:8px 18px;border-radius:999px;}

  </style>
</head>

<body>

<!-- Firebase التحكم + حماية الصفحة -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBfs6I2_EDIVi5miIVVD11eowjesjoQs2o",
    authDomain: "a5er-tasgeel.firebaseapp.com",
    projectId: "a5er-tasgeel",
    storageBucket: "a5er-tasgeel.firebasestorage.app",
    messagingSenderId: "239464150088",
    appId: "1:239464150088:web:71a7288812dcfefc9c147d",
    measurementId: "G-ZJRXVJG9JQ"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  onAuthStateChanged(auth, user => {
    const label = document.getElementById('userLabel');
    const loginBtn = document.getElementById('loginLink');
    const logoutBtn = document.getElementById('logoutBtn');

    if (user) {
      label.textContent = "مسجّل كـ " + user.email;
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";

      logoutBtn.onclick = () => {
        signOut(auth).then(() => window.location.href = "index.html");
      };

    } else {
      label.textContent = "غير مسجّل الدخول";
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";

      alert("يجب تسجيل الدخول للوصول إلى القصة الصوتية");
      window.location.href = "login.html";
    }
  });
</script>

<div class="page">

  <!-- شريط حالة المستخدم -->
  <div class="user-bar">
    <span id="userLabel">—</span>
    <a href="login.html" id="loginLink">تسجيل الدخول</a>
    <button id="logoutBtn" style="display:none;">تسجيل خروج</button>
  </div>

  <!-- هيدر -->
  <header class="hero-with-bg">
    <h1 class="scary-title">آخر تسجيل</h1>
    <p class="hero-subtitle">ملف رعب صوتي… قصة حقيقية بنسخة مسموعة ومكتوبة.</p>
  </header>

  <!-- الروابط -->
  <div class="back-links">
    <a href="index.html">⬅️ الصفحة الرئيسية</a>
    <a href="h18-stories.html">⬅️ قسم قصص رعب +18</a>
  </div>

  <!-- القصة -->
  <section class="story-box">
    <h1 class="story-title">نويميا والكيان</h1>
    <div class="story-meta">تصنيف: رعب / سحر / لعنة عائلية – +18</div>

    <!-- مشغّل الصوت -->
    <div class="player-box">
      <div class="audio-player" id="audioPlayer">
        <audio id="storyAudio" src="audio/download%20(4).wav"></audio>

        <div class="ap-left">
          <button class="ap-play" id="playToggle">
            <span class="icon-play">▶</span>
            <span class="icon-pause">⏸</span>
          </button>
          <div class="ap-info">
            <div class="ap-title">تشغيل التسجيل</div>
            <div class="ap-sub">نويميا والكيان</div>
          </div>
        </div>

        <div class="ap-wave">
          <span></span><span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span><span></span>
        </div>

        <div class="ap-rec">
          <span class="dot"></span>
          <span class="txt">REC</span>
        </div>
      </div>
    </div>

    <!-- زر التحميل -->
    <div style="text-align:center;margin:22px 0;">
      <button id="downloadBtn"
              data-file="audio/download%20(4).wav"
              style="padding:8px 18px;border-radius:999px;background:#ff3333;color:#fff;border:none;cursor:pointer;">
        ⬇️ تحميل ملف الصوت
      </button>
    </div>

    <hr style="margin:22px 0;border-color:rgba(255,255,255,.05);" />

    <!-- نص القصة -->
    <div class="story-text no-copy">
      السحر… موجود…
      ( *** النص الكامل للقصة كما هو *** )
    </div>

  </section>

  <!-- الروابط أسفل -->
  <div class="back-links">
    <a href="index.html">⬅️ الصفحة الرئيسية</a>
    <a href="h18-stories.html">⬅️ قسم قصص رعب +18</a>
  </div>

</div>

<!-- Popup تسجيل الدخول -->
<div id="loginModal" class="login-modal-backdrop">
  <div class="login-modal">
    <h2 class="login-modal-title">تسجيل الدخول مطلوب</h2>
    <p class="login-modal-text">
      لتحميل ملف الصوت يجب أن تكون مسجّل دخول.
    </p>
    <div style="display:flex;gap:10px;justify-content:center;">
      <button id="goLogin" class="btn-primary">تسجيل الدخول</button>
      <button id="closeLogin" class="btn-ghost">إلغاء</button>
    </div>
  </div>
</div>

<script>
  const audioEl   = document.getElementById('storyAudio');
  const playBtn   = document.getElementById('playToggle');
  const playerBox = document.getElementById('audioPlayer');

  playBtn.onclick = () => {
    if (audioEl.paused) {
      audioEl.play();
      playerBox.classList.add("is-playing");
    } else {
      audioEl.pause();
      playerBox.classList.remove("is-playing");
    }
  };

  const downloadBtn = document.getElementById("downloadBtn");
  downloadBtn.onclick = () => {
    if (!localStorage.getItem("loggedIn")) {
      document.getElementById("loginModal").classList.add("show");
      return;
    }
    window.location.href = downloadBtn.dataset.file;
  };

  document.getElementById("goLogin").onclick = () =>
    window.location.href = "login.html";

  document.getElementById("closeLogin").onclick = () =>
    document.getElementById("loginModal").classList.remove("show");
</script>

</body>
</html>
